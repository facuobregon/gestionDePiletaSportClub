@{
    ViewBag.Title = "Usuarios";

}

<h2> Usuarios </h2>
<a class="btn btn-primary" href="@Url.Action("New","User")">Crear usuario</a>
<br />
<div class="row">
    <div class="col-xs-12 col-md-offset-2 col-md-8">

        <table id="customers" class="table table-hover table-responsive table-bordered">
            <thead>
                <tr>
                    <th>Usuario</th>
                    <th>DNI</th>
                    <th>Email</th>
                    <th>Plan</th>
                    <th>Nivel</th>
                    <th>Accion</th>
                </tr>
            </thead>
            <tbody>
               
            </tbody>
        </table>
    </div>
</div>

@section scripts
{
<script>
        $(document).ready(
            function () {

               var table = $("#customers").DataTable(
                    {
                        ajax: {
                            url: "/api/users",
                            dataSrc:""
                        },
                        columns: [
                            {
                                data: "name",
                                render: function (data,type,user) {
                                    return  user.name + " " + user.lastName;
                                }
                            },
                            {
                                data: "dni"
                            },
                            {
                                data: "email",
                            },
                            {
                                data: "membershipType.name",
                            },
                            {
                                data: "level.name",
                            },
                            {
                                data: "id",
                                render: function (data, type, user) {
                                    var edit = "<a href='/user/edit/" + user.id + "'> Edit </a>";
                                    var del = "<button class='btn-link js-delete' data-customer-id=" + data + ">Delete</button>";
                                    return edit + " | " + del;
                                }
                            }
                        ]
                    }
                );


                $("#customers").on("click", ".js-delete",
                    function () {
                        var button = $(this);
                        console.log("Aprete el boton delete");
                        bootbox.confirm("Seguro que desea eliminar este usuario?", function (result) {
                            if (result) {
                                $.ajax(
                                    {
                                        url: "/api/users/" + button.attr("data-customer-id"),
                                        method: "DELETE",
                                        success: function () {
                                            table.row(button.parents("tr")).remove().draw();
                                           
                                        }
                                    }
                                );
                            }
                        });

                    }
                );
            }

        );
</script>
}
